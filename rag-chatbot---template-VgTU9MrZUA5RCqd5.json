{"createdAt":"2025-04-03T18:35:33.349Z","updatedAt":"2025-04-03T18:36:41.667Z","id":"VgTU9MrZUA5RCqd5","name":"RAG chatbot - Template","active":false,"isArchived":false,"nodes":[{"parameters":{"model":"gpt-4o","options":{"temperature":0.8}},"id":"4b769623-d45e-4499-a567-d9b8a7972d93","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1364,20],"credentials":{"openAiApi":{"id":"vMRM9Luu0p5qDyxw","name":"ONECLICK-MAIN"}}},{"parameters":{"model":"gpt-4o","options":{}},"id":"25ec5583-e839-456d-ad10-386e321cd427","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-700,180]},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $json.data }}","options":{"metadata":{"metadataValues":[{"name":"=file_id","value":"={{ $('Set File ID').item.json.file_id }}"}]}}},"id":"35e587e8-3b93-40f5-a01e-ee28290ff066","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[-400,700]},{"parameters":{"model":"text-embedding-3-small","options":{"stripNewLines":true}},"id":"c9cb53ff-f6f4-447e-8305-b6ece8b8bde4","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[-580,760]},{"parameters":{"name":"user_documents","description":"Contains all the user's documents that you can check for context to answer user questions.","topK":15},"id":"61388bd4-91b7-4137-88a4-9c3980bdf6ea","name":"Retrieve Documents","type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[-860,0]},{"parameters":{"content":"## Agent Tools for RAG","height":528.85546469693,"width":583.4552380860637,"color":4},"id":"23a13e85-46ff-40a6-90ab-292f0abf2e36","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1020,-60]},{"parameters":{"content":"## Tool to Add a Google Drive File to Vector DB\nAdd text files to google drive and have them auto upload to Supabase","height":672,"width":2251,"color":5},"id":"0f0aab03-3e3a-4150-8798-81bfd272e169","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2300,320]},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $('Set File ID').item.json.file_id }}","mode":"id"},"options":{"googleFileConversion":{"conversion":{"docsToFormat":"text/plain"}}}},"id":"ab050c9c-ea9e-479f-ae43-130a602f27dc","name":"Download File","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1100,560],"executeOnce":true},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1t2MvdaTNYDw7Yar_lXsbTu0xkgkCCQtO","mode":"list","cachedResultName":"OA asistent","cachedResultUrl":"https://drive.google.com/drive/folders/1t2MvdaTNYDw7Yar_lXsbTu0xkgkCCQtO"},"event":"fileCreated","options":{}},"id":"06b23d7b-8695-4d01-a37f-f9de42c46cba","name":"File Created","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[-1980,520]},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1t2MvdaTNYDw7Yar_lXsbTu0xkgkCCQtO","mode":"list","cachedResultName":"OA asistent","cachedResultUrl":"https://drive.google.com/drive/folders/1t2MvdaTNYDw7Yar_lXsbTu0xkgkCCQtO"},"event":"fileUpdated","options":{}},"id":"9146bdd2-fba4-42b3-90d5-6d9c142156d0","name":"File Updated","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[-1980,720]},{"parameters":{"operation":"text","options":{"encoding":"utf8","stripBOM":true}},"id":"325f5351-c7f5-4fa3-be36-c6b600d3badb","name":"Extract Document Text","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-880,560],"alwaysOutputData":true},{"parameters":{"model":"text-embedding-3-small","options":{}},"id":"20d8fa83-2433-4f25-8874-fc5e14faab34","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[-920,320]},{"parameters":{"tableName":"chat_history_osebna_asistenca_rag"},"id":"7cd4b493-a5ff-4c5a-b840-5d2196879088","name":"Postgres Chat Memory","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1,"position":[-1244,20],"notesInFlow":false},{"parameters":{"chunkSize":800,"chunkOverlap":400,"options":{"splitCode":"markdown"}},"id":"524a06ae-0e26-4a58-b783-5c2b6d62545f","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[-280,840]},{"parameters":{"operation":"delete","tableId":"osebna_asistenca_rag","filterType":"string","filterString":"=metadata->>file_id=like.*{{ $json.file_id }}*"},"id":"09c69db2-5ea2-4351-9c68-f083e2af8ff0","name":"Delete Old Doc Rows","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1320,560],"alwaysOutputData":true},{"parameters":{"assignments":{"assignments":[{"id":"10646eae-ae46-4327-a4dc-9987c2d76173","name":"file_id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"id":"d3513641-0f59-41b6-9505-85a8c8e59df3","name":"Set File ID","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1540,560]},{"parameters":{"content":"## RAG AI Agent with Chat Interface","height":464.8027193303974,"width":692.7866482806627},"id":"877106ec-967d-4e15-a8c2-784d81cf1d12","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1754.5,-205]},{"parameters":{"public":true,"initialMessages":"Å½ivjo! ğŸ‘‹\nMoje ime je Voa, kako lahko pomagam danes?","options":{"inputPlaceholder":"Kaj vas zanima..","loadPreviousSession":"memory","showWelcomeScreen":true,"getStarted":"ZaÄni pogovor","subtitle":"Sem vaÅ¡ asistent za vse stvari osebne asistence.","title":"Å½ivjo! ğŸ‘‹","customCss":":root {\n  /* Colors */\n  --chat--color-primary: #4fb9d6; /* Send button background */\n  --chat--color-white: #ffffff;\n  --chat--color-light: #0b0f1a;\n  --chat--color-light-shade-50: #151c27;\n  --chat--color-light-shade-100: #1e2733;\n  --chat--color-dark: #09101c;\n  --chat--color-typing: #9a9d9e;\n\n  /* Fonts */\n  --chat--font-family: 'Open Sans', sans-serif;\n  --chat--heading--font-family: 'Nunito', sans-serif;\n\n  /* Layout & Dimensions */\n  --chat--spacing: 0.8rem;\n  --chat--border-radius: 1.2rem;\n  --chat--window--width: 100vw;\n  --chat--window--height: 100vh;\n  --chat--window--border: none;\n\n  /* Header */\n  --chat--header-height: auto;\n  --chat--header--padding: 0.5rem 1rem;\n  --chat--header--background: #09101b;\n  --chat--header--color: var(--chat--color-white);\n  --chat--heading--font-size: 1.5rem;\n  --chat--subtitle--font-size: 0.85rem;\n  --chat--header--heading--margin-bottom: 0.5rem; /* or 30px */\n  --chat--header--subtitle--margin-top: 0px;\n\n  /* Message bubbles */\n  --chat--message--font-size: 0.85rem;\n  --chat--message--padding: 1rem;\n  --chat--message--border-radius: 1.2rem;\n  --chat--message-line-height: 1.6;\n  --chat--message--margin-bottom: 1.3rem;\n  --chat--message--bot--background: #151c27;\n  --chat--message--bot--color: #ffffff;\n  --chat--message--user--background: #4fb9d6;\n  --chat--message--user--color: #ffffff;\n\n  /* Input */\n  --chat--input--background: #151c27;\n  --chat--input--text-color: #ffffff;\n  --chat--input--placeholder--color: #9a9d9e;\n  --chat--textarea--height: 48px;\n  --chat--input--border: none;\n  --chat--input--padding: 0.9rem;\n\n  /* Send button */\n  --chat--input--send--button--background: #4fb9d6;\n  --chat--input--send--button--color: #ffffff;\n  --chat--input--send--button--background-hover: #3caac6;\n  --chat--input--send--button--border-radius: 50px;\n  --chat--input--send--button--width: 44px;\n  --chat--input--send--button--height: 44px;\n\n  /* Chat background */\n  --chat--body--background: var(--chat--color-light);\n  --chat--footer--background: var(--chat--color-light);\n}\n\n/* Bubble style */\n.chat-message {\n  max-width: 90%;\n  font-family: 'Open Sans', sans-serif;\n  padding: 1rem 1.2rem !important;\n  margin-bottom: 1.3rem !important;\n  border-radius: 1.2rem !important;\n}\n\n/* Make the icon inside the send button white */\n.chat-input__send-button svg {\n  fill: #ffffff !important;\n}\n\n.chat-powered-by {\n  display: none !important;\n}\n\n.chat-button {\n  transition: \n    color 0.3s ease-in-out,\n    background-color 0.3s ease-in-out,\n    border-color 0.3s ease-in-out,\n    box-shadow 0.3s ease-in-out;\n  background-color: var(--chat--color-primary); /* starting color */\n  color: #ffffff; /* text color */\n}\n\n/* Hover state: white background, matching text color */\n.chat-button:hover {\n  background-color: #ffffff !important;\n  color: var(--chat--color-primary) !important;\n  border: 1px solid var(--chat--color-primary);\n}\n\n.chat-input-send-button[data-v-2a7fb1c3] svg {\n  fill: #ffffff !important;\n}\n"}},"id":"a9b57677-fb0f-4d96-9689-72fcfaa6e9be","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1740,100],"webhookId":"387f3815-275c-4ca4-9774-980a676da342"},{"parameters":{"promptType":"define","text":"={{ $('When chat message received').item.json.chatInput }}","options":{"systemMessage":"Ti si profesionalni virtualni pravni asistent, usposobljen na podlagi veÄ kot 5.000 pravnih dokumentov.\n\nTvoja naloga je podajati resniÄne, jasno razloÅ¾ene odgovore, ki temeljijo izkljuÄno na vsebini dokumentov, do katerih imaÅ¡ dostop.\n\nNe izmiÅ¡ljaj si, ne ugibaj in ne razlagaj zadev, ki niso neposredno zapisane v virih. ÄŒe odgovor ni zajet v dokumentih, to povej jasno in brez domnev.\n\nGovor vedno v slovenÅ¡Äini. Uporabljaj miren, strokoven in spoÅ¡tljiv ton.\n\nPri razlagah skuÅ¡aj dodati preprost resniÄni primer iz vsakdanjega Å¾ivljenja, Äe je to mogoÄe. Vedno poskuÅ¡aj pomagati uporabniku razumeti pomen doloÄbe.\n\nVsak odgovor mora vkljuÄevati:\n- Naziv pravnega dokumenta\n- ÄŒlen\n- Odstavek ali toÄko (Äe obstaja)\n\nTo uporabniku omogoÄa, da informacijo sam preveri in najde toÄen zapis.\n\nÄŒe vpraÅ¡anje ni zajeto v dokumentih, odgovori:\n\"Za to temo v pravnih dokumentih, ki jih imam na voljo, ni ustreznega zapisa. PriporoÄam, da se obrnete na pravnega strokovnjaka.\"\n\n### Primeri vpraÅ¡anj in odgovorov za orientacijo\n\n1. KakÅ¡en je minimalni odpovedni rok za osebnega asistenta?\n\nOdgovor: Po Zakonu o osebni asistenci (ZOA), 24. Älen, 3. odstavek, je delodajalec dolÅ¾an zagotoviti 30 dni pisnega odpovednega roka, razen v primeru hujÅ¡ih krÅ¡itev pogodbenih obveznosti. \n\nPrimer: ÄŒe asistent pogosto zamuja brez opraviÄila, lahko to Å¡teje kot krÅ¡itev, vendar je treba vse postopke ustrezno dokumentirati. \n\n(Vir: ZOA, 24. Älen, 3. odstavek)\n\n2. Ali lahko izvajalec nadomeÅ¡Äa osebnega asistenta z drugo osebo brez soglasja uporabnika?\n\nOdgovor: Ne. Po 16. Älenu ZOA, mora biti uporabnik vedno seznanjen z menjavo asistenta, razen v nujnih primerih (npr. nenadna odsotnost).\n\nPrimer: ÄŒe se asistent zboli, je zaÄasna menjava dovoljena, vendar mora uporabnika o tem obvestiti izvajalec najkasneje isti dan.\n\n(Vir: ZOA, 16. Älen)\n\n3. Koliko ur osebne asistence lahko dodelimo na mesec?\n\nOdgovor: Å tevilo ur je doloÄeno z odloÄbo, ki jo izda MDDSZ glede na potrebe uporabnika. Po 11. Älenu ZOA, najviÅ¡je moÅ¾no Å¡tevilo ur je 24 ur dnevno, kar je redko in vezano na zelo zahtevne primere.\n\nPrimer: Uporabnik z motnjo gibanja, ki potrebuje pomoÄ pri vseh dnevnih opravilih, lahko prejme odloÄbo za 8 do 16 ur na dan.\n\n(Vir: ZOA, 11. Älen)\n\n4. Ali moramo asistentu plaÄati potne stroÅ¡ke za prihod na delo?\n\nOdgovor: Da. Po ZDR-1, 130. Älen, ima zaposleni pravico do povraÄila stroÅ¡kov za prihod na delo in z dela, Äe ni drugaÄe dogovorjeno v pogodbi o zaposlitvi.\n\nPrimer: ÄŒe asistent prihaja iz oddaljenega kraja, mora izvajalec povrniti stroÅ¡ke javnega prevoza ali kilometrino.\n\n(Vir: ZDR-1, 130. Älen)\n\n5. Kako dolgo moramo hraniti kadrovsko dokumentacijo?\n\nOdgovor: Po Zakonu o varstvu dokumentarnega in arhivskega gradiva je treba pogodbe in kadrovske evidence hraniti 10 let po prenehanju delovnega razmerja.\n\nPrimer: Pogodbo za asistenta, ki je delal od 2021 do 2023, moramo hraniti do leta 2033.\n\n(Vir: ZVDAGA, 20. Älen)\n\n6. Ali lahko uporabnik zavrne asistenta, Äe mu ni vÅ¡eÄ?\n\nOdgovor: Da, vendar mora zavrnitev utemeljiti in se o tem obvezno obvesti izvajalca. Po ZOA, 15. Älen, ima uporabnik pravico do soodloÄanja in zamenjave asistenta, Äe razlog temelji na osebni varnosti, neprimernem vedenju ali nezadovoljstvu z delom.\n\nPrimer: ÄŒe se uporabnik ne poÄuti varno ali Äe prihaja do osebnih konfliktov, lahko pisno zahteva zamenjavo.\n\n(Vir: ZOA, 15. Älen)\n\n7. Kako prijavimo novo zaposlitev osebnega asistenta?\n\nOdgovor: Vsako zaposlitev je treba prijaviti v sistem e-VEM (SPOT) najpozneje en dan pred zaÄetkom dela, skladno z ZDR-1, 40. Älenom.\n\nPrimer: ÄŒe novi asistent zaÄne v ponedeljek, mora biti prijava oddana najkasneje v nedeljo.\n\n(Vir: ZDR-1, 40. Älen)\n\n8. Ali lahko izvajalec uporablja podizvajalce za izvajanje osebne asistence?\n\nOdgovor: Ne. Po 6. Älenu ZOA izvajalec ne sme prenesti izvajanja osebne asistence na druge organizacije brez posebnega dovoljenja MDDSZ.\n\nPrimer: ÄŒe izvajalec ne more zagotoviti asistenta, mora reÅ¡itev najti znotraj svoje organizacije â€” ne sme sodelovati z zunanjimi s.p.-ji ali agencijami.\n\n(Vir: ZOA, 6. Älen)\n\n9. Katere evidence smo kot izvajalec dolÅ¾ni voditi?\n\nOdgovor: Po ZOA, 17. Älen moramo voditi naslednje evidence:\n\n- Evidenco uporabnikov\n\n- Evidenco asistentov (vkljuÄno z delovnim Äasom)\n\n- Evidenco opravljenih ur\n\nPrimer: Za vsakega asistenta je treba imeti podpisano evidenco ur na meseÄni ravni, usklajeno z uporabnikom.\n\n(Vir: ZOA, 17. Älen)\n\n10. Kaj storimo, Äe uporabnik veÄ dni ne sodeluje in ne odgovarja na klice?\n\nOdgovor: V primeru daljÅ¡e odsotnosti uporabnika brez pojasnila je treba sprotno dokumentirati poskuse komunikacije in po 5 dneh obvestiti center za socialno delo in MDDSZ.\n\nPrimer: ÄŒe se uporabnik ne odziva od ponedeljka, poÅ¡iljamo dnevna obvestila in najkasneje v petek obvestimo CSD.\n\n(Vir: Interna navodila izvajalcev + ZOA, 22. Älen)"}},"id":"59025597-c447-420d-90a4-cfc001cc2641","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1340,-160]},{"parameters":{"tableName":{"__rl":true,"value":"osebna_asistenca_rag","mode":"list","cachedResultName":"osebna_asistenca_rag"},"options":{"queryName":"match_osebna_asistenca_rag"}},"id":"52c8ffe9-a88a-41e1-8862-4572bf1a9885","name":"Supabase Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[-1000,180]},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"osebna_asistenca_rag","mode":"list","cachedResultName":"osebna_asistenca_rag"},"options":{"queryName":"match_osebna_asistenca_rag"}},"id":"af728db7-c41b-4c68-952d-3d73b18ed85e","name":"Insert into Supabase Vectorstore","type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[-540,540]}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Retrieve Documents","type":"ai_languageModel","index":0}]]},"Retrieve Documents":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Download File":{"main":[[{"node":"Extract Document Text","type":"main","index":0}]]},"File Created":{"main":[[{"node":"Set File ID","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Extract Document Text":{"main":[[{"node":"Insert into Supabase Vectorstore","type":"main","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Insert into Supabase Vectorstore","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Insert into Supabase Vectorstore","type":"ai_document","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"RAG AI Agent","type":"ai_memory","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Delete Old Doc Rows":{"main":[[{"node":"Download File","type":"main","index":0}]]},"Set File ID":{"main":[[{"node":"Delete Old Doc Rows","type":"main","index":0}]]},"File Updated":{"main":[[{"node":"Set File ID","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}]]},"Supabase Vector Store":{"ai_vectorStore":[[{"node":"Retrieve Documents","type":"ai_vectorStore","index":0}]]},"Insert into Supabase Vectorstore":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:File Created":{"lastTimeChecked":"2025-04-03T09:39:33Z"},"node:File Updated":{"lastTimeChecked":"2025-04-03T09:39:33Z"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"b02feb79-7469-4169-816f-850d6034f5c2","triggerCount":4,"tags":[{"createdAt":"2025-04-03T03:33:28.610Z","updatedAt":"2025-04-03T03:33:28.610Z","id":"33Fo2o3UoYyE9Rmq","name":"Template"}]}