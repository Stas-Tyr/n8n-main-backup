{"createdAt":"2025-03-28T14:16:03.044Z","updatedAt":"2025-04-03T09:39:33.411Z","id":"5VP8WTd8nKU1bnPg","name":"OA RAG Chatbot","active":true,"nodes":[{"parameters":{"model":"gpt-4o","options":{"temperature":0.8}},"id":"59a65037-0826-4753-9a90-ebbffdef34f0","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1364,20],"credentials":{"openAiApi":{"id":"vMRM9Luu0p5qDyxw","name":"ONECLICK-MAIN"}}},{"parameters":{"model":"gpt-4o","options":{}},"id":"2719d439-2774-49da-aa7c-bb840ef858c1","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-700,180],"credentials":{"openAiApi":{"id":"vMRM9Luu0p5qDyxw","name":"ONECLICK-MAIN"}}},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $json.data }}","options":{"metadata":{"metadataValues":[{"name":"=file_id","value":"={{ $('Set File ID').item.json.file_id }}"}]}}},"id":"82eebe89-24e9-4998-b1d1-af61c2d5265d","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[-400,700]},{"parameters":{"model":"text-embedding-3-small","options":{"stripNewLines":true}},"id":"b35bf60e-b3bf-4976-b8a7-1b9b0fdf8719","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[-580,760],"credentials":{"openAiApi":{"id":"vMRM9Luu0p5qDyxw","name":"ONECLICK-MAIN"}}},{"parameters":{"name":"user_documents","description":"Contains all the user's documents that you can check for context to answer user questions.","topK":15},"id":"be40c858-1ffa-4326-bc77-315892b4905d","name":"Retrieve Documents","type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[-860,0]},{"parameters":{"content":"## Agent Tools for RAG","height":528.85546469693,"width":583.4552380860637,"color":4},"id":"02ed59a3-bd48-4971-96cd-f488cf8e0113","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1020,-60]},{"parameters":{"content":"## Tool to Add a Google Drive File to Vector DB","height":672,"width":2251,"color":5},"id":"b0fa5134-1e0c-4f11-8a8a-dba99cb9be10","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2300,320]},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $('Set File ID').item.json.file_id }}","mode":"id"},"options":{"googleFileConversion":{"conversion":{"docsToFormat":"text/plain"}}}},"id":"ee6f788e-3562-4d60-adc1-3d37b0f40001","name":"Download File","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1100,560],"executeOnce":true,"credentials":{"googleDriveOAuth2Api":{"id":"2HpbERcyLF4JlqQi","name":"ONECLICK - Google Drive"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1t2MvdaTNYDw7Yar_lXsbTu0xkgkCCQtO","mode":"list","cachedResultName":"OA asistent","cachedResultUrl":"https://drive.google.com/drive/folders/1t2MvdaTNYDw7Yar_lXsbTu0xkgkCCQtO"},"event":"fileCreated","options":{}},"id":"08e21b6a-541b-4f8d-8ef4-fbf50ec7af89","name":"File Created","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[-1980,520],"credentials":{"googleDriveOAuth2Api":{"id":"2HpbERcyLF4JlqQi","name":"ONECLICK - Google Drive"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1t2MvdaTNYDw7Yar_lXsbTu0xkgkCCQtO","mode":"list","cachedResultName":"OA asistent","cachedResultUrl":"https://drive.google.com/drive/folders/1t2MvdaTNYDw7Yar_lXsbTu0xkgkCCQtO"},"event":"fileUpdated","options":{}},"id":"bbe8c9de-767e-44bd-8cf8-4bc6430a55ad","name":"File Updated","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[-1980,720],"credentials":{"googleDriveOAuth2Api":{"id":"2HpbERcyLF4JlqQi","name":"ONECLICK - Google Drive"}}},{"parameters":{"operation":"text","options":{"encoding":"utf8","stripBOM":true}},"id":"dbb84fe2-9ec7-4368-80f2-c4b22830d360","name":"Extract Document Text","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-880,560],"alwaysOutputData":true},{"parameters":{"model":"text-embedding-3-small","options":{}},"id":"bbf96824-0258-4776-a2b4-e247a7369cff","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[-920,320],"credentials":{"openAiApi":{"id":"vMRM9Luu0p5qDyxw","name":"ONECLICK-MAIN"}}},{"parameters":{"tableName":"chat_history_osebna_asistenca_rag"},"id":"2404798b-80ab-4e0a-9436-126d8fe4ca2b","name":"Postgres Chat Memory","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1,"position":[-1244,20],"notesInFlow":false,"credentials":{"postgres":{"id":"k9zhdBNZqYVHhO1c","name":"ONECLICK-Postgres"}}},{"parameters":{"chunkSize":800,"chunkOverlap":400,"options":{"splitCode":"markdown"}},"id":"2a7e09bf-afb1-4214-8d8b-86af10c8db7f","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[-280,840]},{"parameters":{"operation":"delete","tableId":"osebna_asistenca_rag","filterType":"string","filterString":"=metadata->>file_id=like.*{{ $json.file_id }}*"},"id":"4c0cd422-c7c8-4d5b-bcd4-2feead1108a1","name":"Delete Old Doc Rows","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1320,560],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"L5uqTMSc5f8WvP9K","name":"ONECLICK - Main"}}},{"parameters":{"assignments":{"assignments":[{"id":"10646eae-ae46-4327-a4dc-9987c2d76173","name":"file_id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"id":"09eea045-bad5-4881-98cb-6f17c235400e","name":"Set File ID","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1540,560]},{"parameters":{"content":"## RAG AI Agent with Chat Interface","height":464.8027193303974,"width":692.7866482806627},"id":"0f5532ec-67ad-4c2a-9c16-c8385e331d7e","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1754.5,-205]},{"parameters":{"public":true,"initialMessages":"≈Ωivjo! üëã\nMoje ime je Voa, kako lahko pomagam danes?","options":{"inputPlaceholder":"Kaj vas zanima..","loadPreviousSession":"memory","showWelcomeScreen":true,"getStarted":"Zaƒçni pogovor","subtitle":"Sem va≈° asistent za vse stvari osebne asistence.","title":"≈Ωivjo! üëã","customCss":":root {\n  /* Colors */\n  --chat--color-primary: #4fb9d6; /* Send button background */\n  --chat--color-white: #ffffff;\n  --chat--color-light: #0b0f1a;\n  --chat--color-light-shade-50: #151c27;\n  --chat--color-light-shade-100: #1e2733;\n  --chat--color-dark: #09101c;\n  --chat--color-typing: #9a9d9e;\n\n  /* Fonts */\n  --chat--font-family: 'Open Sans', sans-serif;\n  --chat--heading--font-family: 'Nunito', sans-serif;\n\n  /* Layout & Dimensions */\n  --chat--spacing: 0.8rem;\n  --chat--border-radius: 1.2rem;\n  --chat--window--width: 100vw;\n  --chat--window--height: 100vh;\n  --chat--window--border: none;\n\n  /* Header */\n  --chat--header-height: auto;\n  --chat--header--padding: 0.5rem 1rem;\n  --chat--header--background: #09101b;\n  --chat--header--color: var(--chat--color-white);\n  --chat--heading--font-size: 1.5rem;\n  --chat--subtitle--font-size: 0.85rem;\n  --chat--header--heading--margin-bottom: 0.5rem; /* or 30px */\n  --chat--header--subtitle--margin-top: 0px;\n\n  /* Message bubbles */\n  --chat--message--font-size: 0.85rem;\n  --chat--message--padding: 1rem;\n  --chat--message--border-radius: 1.2rem;\n  --chat--message-line-height: 1.6;\n  --chat--message--margin-bottom: 1.3rem;\n  --chat--message--bot--background: #151c27;\n  --chat--message--bot--color: #ffffff;\n  --chat--message--user--background: #4fb9d6;\n  --chat--message--user--color: #ffffff;\n\n  /* Input */\n  --chat--input--background: #151c27;\n  --chat--input--text-color: #ffffff;\n  --chat--input--placeholder--color: #9a9d9e;\n  --chat--textarea--height: 48px;\n  --chat--input--border: none;\n  --chat--input--padding: 0.9rem;\n\n  /* Send button */\n  --chat--input--send--button--background: #4fb9d6;\n  --chat--input--send--button--color: #ffffff;\n  --chat--input--send--button--background-hover: #3caac6;\n  --chat--input--send--button--border-radius: 50px;\n  --chat--input--send--button--width: 44px;\n  --chat--input--send--button--height: 44px;\n\n  /* Chat background */\n  --chat--body--background: var(--chat--color-light);\n  --chat--footer--background: var(--chat--color-light);\n}\n\n/* Bubble style */\n.chat-message {\n  max-width: 90%;\n  font-family: 'Open Sans', sans-serif;\n  padding: 1rem 1.2rem !important;\n  margin-bottom: 1.3rem !important;\n  border-radius: 1.2rem !important;\n}\n\n/* Make the icon inside the send button white */\n.chat-input__send-button svg {\n  fill: #ffffff !important;\n}\n\n.chat-powered-by {\n  display: none !important;\n}\n\n.chat-button {\n  transition: \n    color 0.3s ease-in-out,\n    background-color 0.3s ease-in-out,\n    border-color 0.3s ease-in-out,\n    box-shadow 0.3s ease-in-out;\n  background-color: var(--chat--color-primary); /* starting color */\n  color: #ffffff; /* text color */\n}\n\n/* Hover state: white background, matching text color */\n.chat-button:hover {\n  background-color: #ffffff !important;\n  color: var(--chat--color-primary) !important;\n  border: 1px solid var(--chat--color-primary);\n}\n\n.chat-input-send-button[data-v-2a7fb1c3] svg {\n  fill: #ffffff !important;\n}\n"}},"id":"9121ee36-a482-47f0-8017-8e1e8a04f636","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1740,100],"webhookId":"e373f018-ba0a-47b8-859b-1bc19e7690d4"},{"parameters":{"promptType":"define","text":"={{ $('When chat message received').item.json.chatInput }}","options":{"systemMessage":"Ti si profesionalni virtualni pravni asistent, usposobljen na podlagi veƒç kot 5.000 pravnih dokumentov.\n\nTvoja naloga je podajati resniƒçne, jasno razlo≈æene odgovore, ki temeljijo izkljuƒçno na vsebini dokumentov, do katerih ima≈° dostop.\n\nNe izmi≈°ljaj si, ne ugibaj in ne razlagaj zadev, ki niso neposredno zapisane v virih. ƒåe odgovor ni zajet v dokumentih, to povej jasno in brez domnev.\n\nGovor vedno v sloven≈°ƒçini. Uporabljaj miren, strokoven in spo≈°tljiv ton.\n\nPri razlagah sku≈°aj dodati preprost resniƒçni primer iz vsakdanjega ≈æivljenja, ƒçe je to mogoƒçe. Vedno posku≈°aj pomagati uporabniku razumeti pomen doloƒçbe.\n\nVsak odgovor mora vkljuƒçevati:\n- Naziv pravnega dokumenta\n- ƒålen\n- Odstavek ali toƒçko (ƒçe obstaja)\n\nTo uporabniku omogoƒça, da informacijo sam preveri in najde toƒçen zapis.\n\nƒåe vpra≈°anje ni zajeto v dokumentih, odgovori:\n\"Za to temo v pravnih dokumentih, ki jih imam na voljo, ni ustreznega zapisa. Priporoƒçam, da se obrnete na pravnega strokovnjaka.\"\n\n### Primeri vpra≈°anj in odgovorov za orientacijo\n\n1. Kak≈°en je minimalni odpovedni rok za osebnega asistenta?\n\nOdgovor: Po Zakonu o osebni asistenci (ZOA), 24. ƒçlen, 3. odstavek, je delodajalec dol≈æan zagotoviti 30 dni pisnega odpovednega roka, razen v primeru huj≈°ih kr≈°itev pogodbenih obveznosti. \n\nPrimer: ƒåe asistent pogosto zamuja brez opraviƒçila, lahko to ≈°teje kot kr≈°itev, vendar je treba vse postopke ustrezno dokumentirati. \n\n(Vir: ZOA, 24. ƒçlen, 3. odstavek)\n\n2. Ali lahko izvajalec nadome≈°ƒça osebnega asistenta z drugo osebo brez soglasja uporabnika?\n\nOdgovor: Ne. Po 16. ƒçlenu ZOA, mora biti uporabnik vedno seznanjen z menjavo asistenta, razen v nujnih primerih (npr. nenadna odsotnost).\n\nPrimer: ƒåe se asistent zboli, je zaƒçasna menjava dovoljena, vendar mora uporabnika o tem obvestiti izvajalec najkasneje isti dan.\n\n(Vir: ZOA, 16. ƒçlen)\n\n3. Koliko ur osebne asistence lahko dodelimo na mesec?\n\nOdgovor: ≈†tevilo ur je doloƒçeno z odloƒçbo, ki jo izda MDDSZ glede na potrebe uporabnika. Po 11. ƒçlenu ZOA, najvi≈°je mo≈æno ≈°tevilo ur je 24 ur dnevno, kar je redko in vezano na zelo zahtevne primere.\n\nPrimer: Uporabnik z motnjo gibanja, ki potrebuje pomoƒç pri vseh dnevnih opravilih, lahko prejme odloƒçbo za 8 do 16 ur na dan.\n\n(Vir: ZOA, 11. ƒçlen)\n\n4. Ali moramo asistentu plaƒçati potne stro≈°ke za prihod na delo?\n\nOdgovor: Da. Po ZDR-1, 130. ƒçlen, ima zaposleni pravico do povraƒçila stro≈°kov za prihod na delo in z dela, ƒçe ni drugaƒçe dogovorjeno v pogodbi o zaposlitvi.\n\nPrimer: ƒåe asistent prihaja iz oddaljenega kraja, mora izvajalec povrniti stro≈°ke javnega prevoza ali kilometrino.\n\n(Vir: ZDR-1, 130. ƒçlen)\n\n5. Kako dolgo moramo hraniti kadrovsko dokumentacijo?\n\nOdgovor: Po Zakonu o varstvu dokumentarnega in arhivskega gradiva je treba pogodbe in kadrovske evidence hraniti 10 let po prenehanju delovnega razmerja.\n\nPrimer: Pogodbo za asistenta, ki je delal od 2021 do 2023, moramo hraniti do leta 2033.\n\n(Vir: ZVDAGA, 20. ƒçlen)\n\n6. Ali lahko uporabnik zavrne asistenta, ƒçe mu ni v≈°eƒç?\n\nOdgovor: Da, vendar mora zavrnitev utemeljiti in se o tem obvezno obvesti izvajalca. Po ZOA, 15. ƒçlen, ima uporabnik pravico do soodloƒçanja in zamenjave asistenta, ƒçe razlog temelji na osebni varnosti, neprimernem vedenju ali nezadovoljstvu z delom.\n\nPrimer: ƒåe se uporabnik ne poƒçuti varno ali ƒçe prihaja do osebnih konfliktov, lahko pisno zahteva zamenjavo.\n\n(Vir: ZOA, 15. ƒçlen)\n\n7. Kako prijavimo novo zaposlitev osebnega asistenta?\n\nOdgovor: Vsako zaposlitev je treba prijaviti v sistem e-VEM (SPOT) najpozneje en dan pred zaƒçetkom dela, skladno z ZDR-1, 40. ƒçlenom.\n\nPrimer: ƒåe novi asistent zaƒçne v ponedeljek, mora biti prijava oddana najkasneje v nedeljo.\n\n(Vir: ZDR-1, 40. ƒçlen)\n\n8. Ali lahko izvajalec uporablja podizvajalce za izvajanje osebne asistence?\n\nOdgovor: Ne. Po 6. ƒçlenu ZOA izvajalec ne sme prenesti izvajanja osebne asistence na druge organizacije brez posebnega dovoljenja MDDSZ.\n\nPrimer: ƒåe izvajalec ne more zagotoviti asistenta, mora re≈°itev najti znotraj svoje organizacije ‚Äî ne sme sodelovati z zunanjimi s.p.-ji ali agencijami.\n\n(Vir: ZOA, 6. ƒçlen)\n\n9. Katere evidence smo kot izvajalec dol≈æni voditi?\n\nOdgovor: Po ZOA, 17. ƒçlen moramo voditi naslednje evidence:\n\n- Evidenco uporabnikov\n\n- Evidenco asistentov (vkljuƒçno z delovnim ƒçasom)\n\n- Evidenco opravljenih ur\n\nPrimer: Za vsakega asistenta je treba imeti podpisano evidenco ur na meseƒçni ravni, usklajeno z uporabnikom.\n\n(Vir: ZOA, 17. ƒçlen)\n\n10. Kaj storimo, ƒçe uporabnik veƒç dni ne sodeluje in ne odgovarja na klice?\n\nOdgovor: V primeru dalj≈°e odsotnosti uporabnika brez pojasnila je treba sprotno dokumentirati poskuse komunikacije in po 5 dneh obvestiti center za socialno delo in MDDSZ.\n\nPrimer: ƒåe se uporabnik ne odziva od ponedeljka, po≈°iljamo dnevna obvestila in najkasneje v petek obvestimo CSD.\n\n(Vir: Interna navodila izvajalcev + ZOA, 22. ƒçlen)"}},"id":"6df8d99a-3e83-4fd0-8c5b-0b2c9a1b73e4","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1332,-200]},{"parameters":{"tableName":{"__rl":true,"value":"osebna_asistenca_rag","mode":"list","cachedResultName":"osebna_asistenca_rag"},"options":{"queryName":"match_osebna_asistenca_rag"}},"id":"d46d96ab-2dcc-4e97-9b2f-2491b93e2a35","name":"Supabase Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[-1000,180],"credentials":{"supabaseApi":{"id":"L5uqTMSc5f8WvP9K","name":"ONECLICK - Main"}}},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"osebna_asistenca_rag","mode":"list","cachedResultName":"osebna_asistenca_rag"},"options":{"queryName":"match_osebna_asistenca_rag"}},"id":"bac9c876-1500-47e6-b060-b796613151d1","name":"Insert into Supabase Vectorstore","type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[-540,540],"credentials":{"supabaseApi":{"id":"L5uqTMSc5f8WvP9K","name":"ONECLICK - Main"}}}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Retrieve Documents","type":"ai_languageModel","index":0}]]},"Retrieve Documents":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Download File":{"main":[[{"node":"Extract Document Text","type":"main","index":0}]]},"File Created":{"main":[[{"node":"Set File ID","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Extract Document Text":{"main":[[{"node":"Insert into Supabase Vectorstore","type":"main","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Insert into Supabase Vectorstore","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Insert into Supabase Vectorstore","type":"ai_document","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"RAG AI Agent","type":"ai_memory","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Delete Old Doc Rows":{"main":[[{"node":"Download File","type":"main","index":0}]]},"Set File ID":{"main":[[{"node":"Delete Old Doc Rows","type":"main","index":0}]]},"File Updated":{"main":[[{"node":"Set File ID","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}]]},"Supabase Vector Store":{"ai_vectorStore":[[{"node":"Retrieve Documents","type":"ai_vectorStore","index":0}]]},"Insert into Supabase Vectorstore":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:File Created":{"lastTimeChecked":"2025-04-08T10:27:42Z"},"node:File Updated":{"lastTimeChecked":"2025-04-08T10:27:41Z"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"706b847e-2504-4f49-87d6-a2b27f5ba699","triggerCount":4,"tags":[{"createdAt":"2025-03-28T14:15:47.940Z","updatedAt":"2025-03-28T14:15:47.940Z","id":"iOnfYa6mdB3NBuhZ","name":"OA"}]}